"use strict";angular.module("dicerollerApp",["ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]);var rollNDie=function(a){return Math.floor(Math.random()*a+1)},diceStrMap={1:"⚀",2:"⚁",3:"⚂",4:"⚃",5:"⚄",6:"⚅"},diceStrFromArr=function(a){for(var b="",c=0;c<a.length;c++)b+=diceStrMap[a[c]],c<a.length-1&&(b+=" ");return b};angular.module("dicerollerApp").controller("MainCtrl",["$scope",function(a){a.aNumrolls=0,a.dNumrolls=0,a.clearResults=function(){a.aRolls=null,a.dRolls=null,a.aLoses=null,a.dLoses=null},a.aArmysizeRefresh=function(b){b="undefined"!=typeof b?b:!1;var c=parseInt(a.aArmysize,10),d=parseInt(a.aNumrolls,10);if(!c||2>c)return a.aNumrolls=0,void 0;if(!(d>0&&a.aShowDie(d))||b)for(var e=3;e>0;e--)if(a.aShowDie(e))return a.aNumrolls=e,void 0},a.dArmysizeRefresh=function(b){b="undefined"!=typeof b?b:!1;var c=parseInt(a.dArmysize,10),d=parseInt(a.dNumrolls,10);if(!c||0>c)return a.dNumrolls=0,void 0;if(!(d>0&&a.dShowDie(d))||b)for(var e=2;e>0;e--)if(a.dShowDie(e))return a.dNumrolls=e,void 0},a.aArmysizeUpdate=function(){a.clearResults(),a.aNumrolls=0,a.aArmysizeRefresh()},a.dArmysizeUpdate=function(){a.clearResults(),a.dNumrolls=0,a.dArmysizeRefresh()},a.aShowDie=function(b){if(0==a.aArmysize>1)return!1;var c=parseInt(a.aArmysize,10),d=a.atkrad,e=!1;if(d){var f=Math.min(c-1,3);e=b>=f&&1!==b}return c>b&&!e},a.dShowDie=function(b){if(0==a.dArmysize>0)return!1;var c=parseInt(a.dArmysize,10),d=a.dfndrad,e=a.bunker,f=!1;if(d&&!e){var g=Math.min(c-1,2);f=b>=g&&1!==b}return c>=b&&!f},a.rollOnce=function(){var b=parseInt(a.aArmysize,10),c=parseInt(a.aNumrolls,10),d=parseInt(a.dArmysize,10),e=parseInt(a.dNumrolls,10);if(!(!c||!e||1>c||1>e)){var f=1===a.firepower,g=1===a.ambush,h=1===a.doublecasualties,i=1===a.bunker;f===!0&&(c+=1),i===!0&&(e+=1);var j=0,k=[];for(j=0;c>j;j++)k.push(rollNDie(6));var l=[];for(j=0;e>j;j++)l.push(rollNDie(6));k.sort(function(a,b){return b-a}),l.sort(function(a,b){return b-a}),a.aRolls=diceStrFromArr(k),a.dRolls=diceStrFromArr(l);var m=0,n=Math.min(c,Math.min(e,2));for(j=0;n>j;j++){var o=k[0],p=l[0];g===!0?o>=p&&m++:o>p&&m++,k.shift(),l.shift()}var q=n-m;h===!0&&(m*=2),b=Math.max(b-q,0),d=Math.max(d-m,0),0===d&&(d="☠"),a.aArmysize=b,a.dArmysize=d,a.dLoses=m,a.aLoses=q}}}]);